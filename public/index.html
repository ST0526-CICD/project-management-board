<!DOCTYPE html>
<html>
  <head>
    <title>Project Management</title>
    <style>
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <h1>Project Management</h1>

    <!-- Form to add new task -->
    <form id="taskForm">
      <label for="taskName">Task Name:</label>
      <input type="text" id="taskName" name="taskName" required />
      <label for="taskStatus">Status:</label>
      <select id="taskStatus" name="taskStatus" required></select>
      <button type="submit">Add Task</button>
    </form>

    <h2>All Tasks</h2>

    <!-- Table to view all tasks -->
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="tasksTableBody">
        <!-- Rows will be populated by JavaScript -->
      </tbody>
    </table>

    <!-- Template for task row -->
    <template id="taskRowTemplate">
      <tr>
        <td class="task-id"></td>
        <td class="task-name"></td>
        <td class="task-status"></td>
        <td>
          <button class="delete-button">Delete</button>
        </td>
      </tr>
    </template>

    <script>
      const apiUrl = '.'; // Adjust this URL if your API is hosted elsewhere

      // Function to populate the status options
      function populateStatusOptions() {
        fetch(`${apiUrl}/statuses`)
          .then((response) => response.json())
          .then((statuses) => {
            const taskStatus = document.getElementById('taskStatus');
            statuses.forEach((status) => {
              const option = document.createElement('option');
              option.value = status.id;
              option.textContent = status.text;
              taskStatus.appendChild(option);
            });
          })
          .catch((error) => console.error('Error fetching statuses:', error));
      }

      // Function to populate the tasks table
      function populateTasksTable() {
        fetch(`${apiUrl}/tasks`)
          .then((response) => response.json())
          .then((tasks) => {
            const tasksTableBody = document.getElementById('tasksTableBody');
            const template = document.getElementById('taskRowTemplate').content;
            tasksTableBody.innerHTML = ''; // Clear existing rows

            tasks.forEach((task) => {
              const row = document.importNode(template, true);
              row.querySelector('.task-id').textContent = task.id;
              row.querySelector('.task-name').textContent = task.name;
              row.querySelector('.task-status').textContent = task.status.text;
              row.querySelector('.delete-button').onclick = function () {
                deleteTask(task.id);
              };
              tasksTableBody.appendChild(row);
            });
          })
          .catch((error) => console.error('Error fetching tasks:', error));
      }

      // Function to add a new task
      function addTask(event) {
        event.preventDefault();
        const taskName = document.getElementById('taskName').value;
        const taskStatus = document.getElementById('taskStatus').value;

        fetch(`${apiUrl}/tasks`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ name: taskName, statusId: +taskStatus }),
        })
          .then((response) => response.json())
          .then((task) => {
            populateTasksTable(); // Refresh the table
            document.getElementById('taskForm').reset(); // Reset the form
          })
          .catch((error) => console.error('Error adding task:', error));
      }

      // Function to delete a task
      function deleteTask(id) {
        fetch(`${apiUrl}/tasks/${id}`, {
          method: 'DELETE',
        })
          .then(() => {
            populateTasksTable(); // Refresh the table
          })
          .catch((error) => console.error('Error deleting task:', error));
      }

      document.addEventListener('DOMContentLoaded', function () {
        // Populate the status options on page load
        populateStatusOptions();

        // Event listener for form submission
        document.getElementById('taskForm').addEventListener('submit', addTask);

        // Populate the tasks table on page load
        populateTasksTable();
      });
    </script>
  </body>
</html>
